<div class="alert alert-info" *ngIf="adminAccess">You have admin access for this course</div>

<div class="jumbotron jumbotron" *ngIf="course">
  <div class="favorite-toggle" (click)="updateFavoriteCourse()">
    <button>
      <fa name="star" *ngIf="(favorite$ | async)"></fa>
      <fa name="star-o" *ngIf="(favorite$ | async) == false"></fa>
    </button>
  </div>
  <h1 class="display-4">{{ course.name }} ({{ course.id }})</h1>
  <div class="lead" [innerHTML]="course.description"></div>
  <p class="lead">
    <a class="btn btn-primary mr-2" [attr.href]="'https://www.facebook.com/search/groups/?q=' + course.id"
       target="_blank">
      <fa name="facebook" class="mr-2"></fa>
      Facebook Group</a>
    <a *ngIf="course.id.toString().startsWith('23')" class="btn btn-secondary mr-2"
       [attr.href]="'https://webcourse.cs.technion.ac.il/'+ course.id" target="_blank">
      <fa name="globe" class="mr-2"></fa>
      Course Website</a>
    <button *ngIf="adminAccess" role="button" class="btn btn-info mr-2" data-toggle="modal" data-target="#addTagModal">
      <fa name="plus" class="mr-1"></fa>
      Add New Tag
    </button>
    <button *ngIf="adminAccess" role="button" class="btn btn-danger mr-2" data-toggle="modal"
            data-target="#editCourseModal">
      <fa name="edit" class="mr-1"></fa>
      Edit Course Details
    </button>
</div>

<div class="modal fade" id="editCourseModal" tabindex="-1" role="dialog" aria-hidden="true" *ngIf="course">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Course Details</h2>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="courseName">Name:</label>
            <input type="text" class="form-control" id="courseName" placeholder="Enter name" name="subject"
                   [(ngModel)]="course.name">
          </div>
          <div class="form-group">
            <label for="desc-editor">Description:</label>
            <ck-editor name="editor1" id="desc-editor" [(ngModel)]="course.description" skin="moono-lisa"></ck-editor>
          </div>
          <button type="submit" class="btn btn-primary mb-2" (click)="editCourseDetails()" data-dismiss="modal">Post</button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="addTagModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <input type="text" class="form-control" placeholder="New Tag" [(ngModel)]="newTag" name="courseName"/>
        <button type="submit" data-dismiss="modal" class="btn btn-success" (click)="addNewTag();">Add</button>
      </div>
    </div>
  </div>
</div>

<table matSort (matSortChange)="sortTags($event)" class="table table-hover" *ngIf="tags">
  <thead>
  <tr class="table-warning">
    <th colspan="4" mat-sort-header="tag">
      Tags
      <span class="badge badge-warning">{{tags.length}}</span>
    </th>
  </tr>
  </thead>
  <tbody>
  <tr class="clickable" routerLink="tag/{{ tag }}" *ngFor="let tag of tags">
    <td>#{{ tag }}</td>
  </tr>
  </tbody>
</table>

<table matSort (matSortChange)="sortExams($event)" class="table table-hover" *ngIf="exams">
  <thead>
  <tr class="table-primary">
    <th colspan="4">
      Available Exams
      <span class="badge badge-primary">{{exams.length}}</span>
    </th>
  </tr>
  <tr class="table-light">
    <th class="text-center" scope="col" style="width: 10%" mat-sort-header="year">Year</th>
    <th class="text-center" scope="col" style="width: 10%" mat-sort-header="semester">Semester</th>
    <th class="text-center" scope="col" style="width: 10%" mat-sort-header="moed">Moed</th>
    <th class="text-center" scope="col" style="width: 10%"></th>
  </tr>
  </thead>
  <tbody>
  <tr class="clickable" routerLink="exam/{{ e.id }}" *ngFor="let e of exams">
    <td>{{ e.year }}</td>
    <td>{{ e.semester | titlecase}}</td>
    <td>{{ e.moed | titlecase}}</td>
    <td></td>
  </tr>
  </tbody>
</table>

<table matSort (matSortChange)="sortQuestions($event)" class="table table-hover" *ngIf="questions">
  <thead>
  <tr class="table-danger">
    <th colspan="4">
      Questions
      <span class="badge badge-danger">{{questions.length}}</span>
    </th>
  </tr>
  <tr class="table-light">
    <th class="text-center" scope="col" style="width: 10%" mat-sort-header="year">Year</th>
    <th class="text-center" scope="col" style="width: 10%" mat-sort-header="semester">Semester</th>
    <th class="text-center" scope="col" style="width: 10%" mat-sort-header="moed">Moed</th>
    <th class="text-center" scope="col" style="width: 10%" mat-sort-header="number">Question No.</th>
  </tr>
  </thead>
  <tbody>
  <tr class="clickable" routerLink="/question/{{ q.id }}" *ngFor="let q of questions">
    <td>{{ q.year }}</td>
    <td>{{ q.semester | titlecase}}</td>
    <td>{{ q.moed | titlecase}}</td>
    <td>{{ q.number }}</td>
  </tr>
  </tbody>
</table>

<div class="list-group my-3" *ngIf="topics$ | async as topics">
  <div class="list-group-item list-group-item-info">
    <b>Forum </b>
    <span class="badge badge-info">{{topics.length}}</span>
    <button role="button" class="btn btn-info float-right" data-toggle="modal" data-target="#createTopicModal">
      <fa name="plus" class="mr-1"></fa>
      Add Topic
    </button>
  </div>
  <a routerLink="/topic/{{ topic.id }}" class="list-group-item list-group-item-action" *ngFor="let topic of topics;">
    {{ topic.subject }}
    <span class="float-right col-4">
      <img [src]="topic.creator.photoUrl" class="mr-2 topic-creator-profile-pic" alt=""/>
      <small class="mr-2">{{ topic.creator.name }}</small>
      <small class="float-right">{{ topic.created.toDate() | date: 'dd/MM/yyyy HH:mm' }}</small>
    </span>
  </a>
</div>
<div class="modal fade" id="createTopicModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Create new topic</h2>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <app-create-topic [linkedCourseId]="id"></app-create-topic>
      </div>
    </div>
  </div>
</div>

<app-pending-scans-list [course]="course.id" *ngIf="course"></app-pending-scans-list>
